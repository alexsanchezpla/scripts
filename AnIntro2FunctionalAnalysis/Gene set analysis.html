<!DOCTYPE html>
<!-- saved from url=(0062)http://genomicsclass.github.io/book/pages/bioc1_geneset_1.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>Gene set analysis</title>
    
    <meta name="author" content="Rafael Irizarry and Michael Love">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="./Gene set analysis_files/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="./Gene set analysis_files/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="./Gene set analysis_files/kbroman.css" rel="stylesheet" type="text/css" media="all">
    <link href="./Gene set analysis_files/knitr.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
    <link href="http://genomicsclass.github.io/book/assets/themes/twitter/ico/favicon.ico" rel="icon" type="image/png">

    <!-- atom & rss feed -->
    <link href="http://genomicsclass.github.io/booknil" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="http://genomicsclass.github.io/booknil" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <!-- knitr javascript -->
    <script src="./Gene set analysis_files/knitr.js.descarga" type="text/javascript"></script>

    <!-- mathjax javascript -->
    <script type="text/x-mathjax-config;executed=true">
      MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>

    <script src="./Gene set analysis_files/MathJax.js.descarga"></script>


  <style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.0') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">@font-face {font-family: MathJax_AMS; src: url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?V=2.7.0') format('woff'), url('https://cdn.mathjax.org/mathjax/2.7-latest/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?V=2.7.0') format('opentype')}
</style></head>

  <body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="http://genomicsclass.github.io/book">PH525x series - Biomedical Data Science</a>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        

<div class="page-header">
  <h2>Gene set analysis </h2>
</div>

<div class="row-fluid">
  <div class="span12">
    <p><a name="genesetanalysis"></a></p>

<h1 id="gene-set-analysis">Gene Set Analysis</h1>

<p>In these units we learn the statistics behind gene set analysis. Throughout the unit you should keep three important steps in mind that are all important yet can be kept separated from each other. These are
1) The gene sets considered
2) The statistic used to summarize each gene set. 
3) The approach to assessing uncertainty</p>

<p>We will cover each of these three topics in separate units.</p>

<h2 id="preparing-data-and-gene-set-database">Preparing data and gene set database</h2>
<p>For this unit you will need the following library</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">source</span><span class="p">(</span><span class="s2">"http://www.bioconductor.org/biocLite.R"</span><span class="p">)</span><span class="w">
</span><span class="n">biocLite</span><span class="p">(</span><span class="s2">"GSEABase"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>We will need these packages:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rafalib</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">GSEABase</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>In previous sections we have used a dataset comparing males and females. 
We will need the following package which is available from the class github repo:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span><span class="w">
</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"genomicsclass/GSE5859Subset"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>We constructed this data to include batch effect so we 
correct for them using SVA:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">GSE5859Subset</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">GSE5859Subset</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sva</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">limma</span><span class="p">)</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleInfo</span><span class="o">$</span><span class="n">group</span><span class="w">
</span><span class="n">mod</span><span class="o">&lt;-</span><span class="n">model.matrix</span><span class="p">(</span><span class="o">~</span><span class="n">X</span><span class="p">)</span><span class="w">
</span><span class="n">svafit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">geneExpression</span><span class="p">,</span><span class="n">mod</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Number of significant surrogate variables is:  5 
## Iteration (out of 5 ):1  2  3  4  5
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">svaX</span><span class="o">&lt;-</span><span class="n">model.matrix</span><span class="p">(</span><span class="o">~</span><span class="n">X</span><span class="o">+</span><span class="n">svafit</span><span class="o">$</span><span class="n">sv</span><span class="p">)</span><span class="w">
</span><span class="n">lmfit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmFit</span><span class="p">(</span><span class="n">geneExpression</span><span class="p">,</span><span class="n">svaX</span><span class="p">)</span><span class="w">
</span><span class="n">tt</span><span class="o">&lt;-</span><span class="n">lmfit</span><span class="o">$</span><span class="n">coef</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">lmfit</span><span class="o">$</span><span class="n">df.residual</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">lmfit</span><span class="o">$</span><span class="n">sigma</span><span class="p">)</span><span class="w">
</span><span class="n">pval</span><span class="o">&lt;</span><span class="m">-2</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">pt</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">tt</span><span class="p">),</span><span class="n">lmfit</span><span class="o">$</span><span class="n">df.residual</span><span class="p">[</span><span class="m">1</span><span class="p">]))</span><span class="w">
</span><span class="n">qval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p.adjust</span><span class="p">(</span><span class="n">pval</span><span class="p">,</span><span class="s2">"BH"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Note that all we really need for this unit is score for each gene and a candidate list of differentially expressed genes. The details of how we obtain them are not relevant to the of the unit. To illustrate we will pretend we don’t know a-priori the relationship between the outcome and gene expression.</p>

<p>Let’s begin by constructing a list of candidate genes with an FDR of 25%. This gives us a list of 23 genes. What biology can we learn? Given that we know that genes work together, it makes sense to study groups of genes instead of individual ones. In general, this is the idea behind <em>gene set analysis</em>.</p>

<p>There are various resources on the web that provide gene sets. Most of these have been curated and are composed of genes with something in common. A typical way of grouping them is by pathways (e.g. <a href="http://www.genome.jp/kegg/">KEGG</a>)
or biological function (e.g. <a href="http://www.geneontology.org/">Gene Ontology</a>). A great resource with many curated gene sets can be found here:</p>

<p><a href="http://www.broadinstitute.org/gsea/msigdb/index.jsp">http://www.broadinstitute.org/gsea/msigdb/index.jsp</a></p>

<p>In this example we will use a gene set grouping genes by sections of the chromosome. The first step is to download the database. You can download the file from here (you have to register)</p>

<p><a href="http://www.broadinstitute.org/gsea/msigdb/download_file.jsp?filePath=/resources/msigdb/4.0/c1.all.v4.0.entrez.gmt">http://www.broadinstitute.org/gsea/msigdb/download_file.jsp?filePath=/resources/msigdb/4.0/c1.all.v4.0.entrez.gmt</a></p>

<p>Once you download the file, you can read it in with the following command</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">gsets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getGmt</span><span class="p">(</span><span class="s2">"c1.all.v4.0.entrez.gmt"</span><span class="p">)</span><span class="w"> </span><span class="c1">##must provide correct path to file
</span></code></pre>
</div>

<p>This object has 326 gene sets. Each gene set contains the ENTREZ IDs for the genes in each gene set</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">gsets</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 326
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">gsets</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] "chr5q23"  "chr16q24" "chr8q24"  "chr13q11" "chr7p21"  "chr10q23"
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">gsets</span><span class="p">[[</span><span class="s2">"chryq11"</span><span class="p">]]</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## setName: chryq11 
## geneIds: 728512, 392597, ..., 360027 (total: 204)
## geneIdType: Null
## collectionType: Null 
## details: use 'details(object)'
</code></pre>
</div>
<p>and we can access the ENTREZ ids in the following way:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">geneIds</span><span class="p">(</span><span class="n">gsets</span><span class="p">[[</span><span class="s2">"chryq11"</span><span class="p">]]))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] "728512" "392597" "9086"   "359796" "83864"  "425057"
</code></pre>
</div>

<p>Now to apply this to our data we have to map these IDS to Affymetrix IDs. We will write a simple function that takes a Expression Set and</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">mapGMT2Affy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">object</span><span class="p">,</span><span class="n">gsets</span><span class="p">){</span><span class="w">
  </span><span class="n">ann</span><span class="o">&lt;-</span><span class="n">annotation</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="w">
  </span><span class="n">dbname</span><span class="o">&lt;-</span><span class="n">paste</span><span class="p">(</span><span class="n">ann</span><span class="p">,</span><span class="s2">"db"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"."</span><span class="p">)</span><span class="w">
  </span><span class="n">require</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span><span class="n">character.only</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="n">gns</span><span class="o">&lt;-</span><span class="n">featureNames</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="w">

  </span><span class="c1">##This call may generate warnings
</span><span class="w">  </span><span class="n">map</span><span class="o">&lt;-</span><span class="n">select</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">dbname</span><span class="p">),</span><span class="w"> </span><span class="n">keys</span><span class="o">=</span><span class="n">gns</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"ENTREZID"</span><span class="p">,</span><span class="w"> </span><span class="s2">"PROBEID"</span><span class="p">))</span><span class="w">
  </span><span class="n">map</span><span class="o">&lt;-</span><span class="n">split</span><span class="p">(</span><span class="n">map</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">map</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="w">
  </span><span class="n">indexes</span><span class="o">&lt;-</span><span class="n">sapply</span><span class="p">(</span><span class="n">gsets</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">ids</span><span class="p">){</span><span class="w">
    </span><span class="n">gns2</span><span class="o">&lt;-</span><span class="n">unlist</span><span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">geneIds</span><span class="p">(</span><span class="n">ids</span><span class="p">)])</span><span class="w">
    </span><span class="n">match</span><span class="p">(</span><span class="n">gns2</span><span class="p">,</span><span class="n">gns</span><span class="p">)</span><span class="w">
    </span><span class="p">})</span><span class="w">
  </span><span class="nf">names</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">names</span><span class="p">(</span><span class="n">gsets</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1">##create an Expression Set
</span><span class="n">rownames</span><span class="p">(</span><span class="n">sampleInfo</span><span class="p">)</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">geneExpression</span><span class="p">)</span><span class="w">
</span><span class="n">e</span><span class="o">=</span><span class="n">ExpressionSet</span><span class="p">(</span><span class="n">assay</span><span class="o">=</span><span class="n">geneExpression</span><span class="p">,</span><span class="w">
                </span><span class="n">phenoData</span><span class="o">=</span><span class="n">AnnotatedDataFrame</span><span class="p">(</span><span class="n">sampleInfo</span><span class="p">),</span><span class="w">
                </span><span class="n">annotation</span><span class="o">=</span><span class="s2">"hgfocus"</span><span class="p">)</span><span class="w">
</span><span class="c1">##can safely ignore the warning
</span><span class="n">gsids</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mapGMT2Affy</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">gsets</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Loading required package: hgfocus.db
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Loading required package: org.Hs.eg.db
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Loading required package: DBI
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 'select()' returned 1:many mapping between keys and columns
</code></pre>
</div>

<h2 id="approaches-based-on-association-tests">Approaches based on association tests</h2>

<p>Now we can now ask if differentially expressed genes are enriched in a given gene set. So how do we do this? The simplest approach is to  apply a chi-square test for independence that we learned in a previous units. Let’s do this for one of the Y chromosome gene sets:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">tab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">ingenset</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">gsids</span><span class="p">[[</span><span class="s2">"chryq11"</span><span class="p">]],</span><span class="n">signif</span><span class="o">=</span><span class="n">qval</span><span class="o">&lt;</span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span><span class="n">chisq.test</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span><span class="o">$</span><span class="n">p.val</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Warning in chisq.test(tab): Chi-squared approximation may be incorrect
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 5.264033e-121
</code></pre>
</div>

<p>Because we are comparing men to women so it is not surprising the genes on the Y chromosome are enriched for differential expression. However, with only 13 reaching significance (4 of the on Y), this method is not practical for finding other gene sets that may be biologically interesting in some way. For example, are X chromosome gene sets of interest? Note that some genes escape X inactivation and thus should have more gene expression in females.</p>

<p>A problem here is that an FDR of 0.25 is an arbitrary cutoff. Why not 0.05 or 0.10? Where do we draw the cutoff?</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rafalib</span><span class="p">)</span><span class="w">
</span><span class="n">mypar</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">qs</span><span class="o">&lt;-</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">len</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span><span class="m">+1</span><span class="p">)</span><span class="m">-1</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="nf">length</span><span class="p">(</span><span class="n">tt</span><span class="p">));</span><span class="n">qs</span><span class="o">&lt;-</span><span class="n">qs</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span><span class="w">
</span><span class="n">qqplot</span><span class="p">(</span><span class="n">qt</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span><span class="n">lmfit</span><span class="o">$</span><span class="n">df.resid</span><span class="p">),</span><span class="n">tt</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-10</span><span class="p">,</span><span class="m">10</span><span class="p">),</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Theoretical quantiles"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Observed"</span><span class="p">)</span><span class="w"> </span><span class="c1">##note we leave some of the obvious ones out
</span><span class="n">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="./Gene set analysis_files/bioc1_geneset_1-unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10"></p>

<p>A summary of this approach to gene set analysis is provided by 
<a href="http://genomicsclass.github.io/book/pages/bioc1_geneset_1.html#foot">Goeman and Bühlmann 2006</a>.</p>

<p><a name="summaries"></a></p>

<h2 id="gene-set-summary-statistics">Gene set summary statistics</h2>

<p>Most current approaches to gene sets analysis do not divide genes into differentially and non-differentially expressed. Instead, we make use of a statistic such as the t-test. To see how this is more powerful that dichotomizing the gene list, suppose we ask the question: do some genes escape X inactivation? Instead of creating a table as we did above, instead we look at the distribution of t-statistics for the first group in the X chromosome</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ind</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsids</span><span class="p">[[</span><span class="s2">"chrxp11"</span><span class="p">]]</span><span class="w">
</span><span class="n">mypar</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="o">-</span><span class="n">ind</span><span class="p">]),</span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-7</span><span class="p">,</span><span class="m">7</span><span class="p">),</span><span class="n">main</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"t-stat"</span><span class="p">,</span><span class="n">sub</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">lwd</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span><span class="n">bw</span><span class="o">=</span><span class="m">.7</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">lwd</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">rug</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="./Gene set analysis_files/bioc1_geneset_1-unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"></p>

<p>Note that the gene set distribution shifts a bit to the left providing evidence that the distribution of the t-statistics in this gene set is different from the distribution for all genes. So how do we quantify this observation? How do we assess uncertainty.</p>

<p>The first published approach to performing gene set analysis <a href="http://genomicsclass.github.io/book/pages/bioc1_geneset_1.html#foot">Virtaneva 2001</a> used the Wilcoxon Mann-Whitney tests discussed in a previous unit. The basic idea was to test if the difference between cases and controls was generally bigger in a given gene set compared to the rest of the genes. The Wilcoxon compares the ranks in the gene sets are generally above the median.</p>

<p>Here we compute the Wilcoxon test for each gene set. We then standardize the Wilcoxon statistic to have mean 0 and standard deviation 1. Note that the central limit theorem tell us that if the gene sets are large enough and the effect size for each gene are independent of each other then these statistics will follow a normal distribution.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">es</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmfit</span><span class="o">$</span><span class="n">coef</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">wilcox</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">gsids</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">){</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="m">2</span><span class="p">){</span><span class="w">
  </span><span class="n">tmp</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">wilcox.test</span><span class="p">(</span><span class="n">es</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">es</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">])</span><span class="w">  
  </span><span class="n">n</span><span class="m">1</span><span class="o">&lt;-</span><span class="nf">length</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="n">n</span><span class="m">2</span><span class="o">&lt;-</span><span class="nf">length</span><span class="p">(</span><span class="n">es</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="m">1</span><span class="w">
  </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="o">$</span><span class="n">stat</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="m">1</span><span class="o">*</span><span class="n">n</span><span class="m">2</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="m">1</span><span class="o">*</span><span class="n">n</span><span class="m">2</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="m">1</span><span class="o">+</span><span class="n">n</span><span class="m">2+1</span><span class="p">)</span><span class="o">/</span><span class="m">12</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">tmp</span><span class="o">$</span><span class="n">p.value</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">  
  </span><span class="p">}))</span><span class="w">
</span><span class="n">mypar</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">wilcox</span><span class="p">))</span><span class="w">
</span><span class="n">cols</span><span class="p">[</span><span class="n">grep</span><span class="p">(</span><span class="s2">"chrx"</span><span class="p">,</span><span class="n">rownames</span><span class="p">(</span><span class="n">wilcox</span><span class="p">))]</span><span class="o">&lt;</span><span class="m">-2</span><span class="w">
</span><span class="n">cols</span><span class="p">[</span><span class="n">grep</span><span class="p">(</span><span class="s2">"chry"</span><span class="p">,</span><span class="n">rownames</span><span class="p">(</span><span class="n">wilcox</span><span class="p">))]</span><span class="o">&lt;</span><span class="m">-3</span><span class="w">
</span><span class="n">qqnorm</span><span class="p">(</span><span class="n">wilcox</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="n">ifelse</span><span class="p">(</span><span class="n">cols</span><span class="o">==</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">wilcox</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Autosome"</span><span class="p">,</span><span class="s2">"chrX"</span><span class="p">,</span><span class="s2">"chrY"</span><span class="p">),</span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="n">box.lwd</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="./Gene set analysis_files/bioc1_geneset_1-unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"></p>

<p>Note that the top ten does not show the X and Y chromosomes as highly expressed as we expected. The logic for using a rank based (robust) test was that we do not want one or two very highly expressed genes to dominate the gene set analysis.  However, although low rank based tests are very useful at protecting us from false positive they come at the cost of low low sensitive (power). Below we consider less robust, yet generally more powerful approaches.</p>

<p>If we are interested in gene sets with distributions that shift to the left (generally more under expressed genes) or the right (generally more over expressed genes) then the simplest test we can construct simply compares the average between the two groups. A very simple summary we can construct to test for mean shits is to average the t-statistic in gene set <a href="http://www.ncbi.nlm.nih.gov/pubmed/?term=20048385">http://www.ncbi.nlm.nih.gov/pubmed/?term=20048385</a>. Basically for let G be the index of genes in the gene sets and define:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 6.789em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.658em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.658em 1005.66em 3.634em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="texatom" id="MathJax-Span-3"><span class="mrow" id="MathJax-Span-4"><span class="munderover" id="MathJax-Span-5"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-7" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-8" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span><span class="mfrac" id="MathJax-Span-9" style="padding-left: 0.301em;"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mn" id="MathJax-Span-10" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.271em; left: 50%; margin-left: -0.414em;"><span class="mi" id="MathJax-Span-11" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1001.01em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.015em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span><span class="munderover" id="MathJax-Span-12" style="padding-left: 0.182em;"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(2.86em 1001.37em 4.646em -999.997em); top: -3.985em; left: 0em;"><span class="mo" id="MathJax-Span-13" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.336em 1001.25em 4.289em -999.997em); top: -2.854em; left: 0.063em;"><span class="texatom" id="MathJax-Span-14"><span class="mrow" id="MathJax-Span-15"><span class="mi" id="MathJax-Span-16" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-17" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-18" style="font-size: 70.7%; font-family: MathJax_Math-italic;">G</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-19" style="padding-left: 0.182em;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-20" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.36em;"><span class="mi" id="MathJax-Span-21" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.568em; border-left: 0px solid; width: 0px; height: 3.218em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>∈</mo><mi>G</mi></mrow></munder><msub><mi>t</mi><mi>i</mi></msub></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">\bar{t}=\frac{1}{N} \sum_{i \in G} t_i</script>

<p>Note that under the null hypothesis that the genes in the gene set are not differentially expressed, then these <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-22" style="width: 0.479em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.36em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.372em 1000.3em 2.384em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-23"><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">t</script> have mean 0. If they t-statistics are independent of each other (later we will learn approaches that avoid this assumption) then <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msqrt&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msqrt&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-25" style="width: 2.979em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.443em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1002.38em 2.562em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-26"><span class="msqrt" id="MathJax-Span-27"><span style="display: inline-block; position: relative; width: 1.848em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0.836em;"><span class="mrow" id="MathJax-Span-28"><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.515em 1001.01em 3.932em -999.997em); top: -4.521em; left: 0.836em;"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: -0.057em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: 0.301em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1000.84em 4.348em -999.997em); top: -4.045em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="texatom" id="MathJax-Span-30"><span class="mrow" id="MathJax-Span-31"><span class="munderover" id="MathJax-Span-32"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-33" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-34" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msqrt><mi>N</mi></msqrt><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3">\sqrt{N} \bar{t}</script> has standard deviation 1 and are approximately normal:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msqrt&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msqrt&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-35" style="width: 8.336em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.908em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1006.79em 2.622em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-36"><span class="msqrt" id="MathJax-Span-37"><span style="display: inline-block; position: relative; width: 1.848em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0.836em;"><span class="mrow" id="MathJax-Span-38"><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.515em 1001.01em 3.932em -999.997em); top: -4.521em; left: 0.836em;"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: -0.057em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: 0.301em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1000.84em 4.348em -999.997em); top: -3.985em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="texatom" id="MathJax-Span-40"><span class="mrow" id="MathJax-Span-41"><span class="munderover" id="MathJax-Span-42"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-44" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-45" style="font-family: MathJax_Main; padding-left: 0.301em;">∼</span><span class="mi" id="MathJax-Span-46" style="font-family: MathJax_Math-italic; padding-left: 0.301em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-47" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-48" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-49" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-50" style="font-family: MathJax_Main; padding-left: 0.182em;">1</span><span class="mo" id="MathJax-Span-51" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msqrt><mi>N</mi></msqrt><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-4">\sqrt{N} \bar{t} \sim N(0,1)</script>

<p>Here is a qq-plot of these summary</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">avgt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">gsids</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">mean</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="w">
</span><span class="n">qqnorm</span><span class="p">(</span><span class="n">avgt</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="n">ifelse</span><span class="p">(</span><span class="n">cols</span><span class="o">==</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">avgt</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Autosome"</span><span class="p">,</span><span class="s2">"chrX"</span><span class="p">,</span><span class="s2">"chrY"</span><span class="p">),</span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="n">box.lwd</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="./Gene set analysis_files/bioc1_geneset_1-unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13"></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">avgt</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">avgt</span><span class="p">))[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">]]</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##    chryp11    chryq11    chrxq13    chr6p22   chr17p13    chrxp11 
## -17.749865 -15.287203   6.592806  -4.558008  -4.545851   4.420686 
##   chr20p13    chr4q35    chr7p22    chrxp22 
##  -4.241892  -4.033233  -3.642068   3.608926
</code></pre>
</div>

<p>Several methods are based on summaries designed to test shifts in means: for example <a href="http://www.ncbi.nlm.nih.gov/pubmed/16174746">Tian et al 2005</a> , <a href="http://www.ncbi.nlm.nih.gov/pubmed/15647293">SAFE</a>, <a href="http://www.ncbi.nlm.nih.gov/pubmed/?term=20610611">ROAST</a>, <a href="http://www.ncbi.nlm.nih.gov/pubmed/22638577">CAMERA</a>.</p>

<p>Note that we can construct other scores to test other alternative hypothesis. For example, we can test for <a href="http://www.ncbi.nlm.nih.gov/pubmed/?term=20048385">changes in variances</a> and general changes in distribution [<a href="http://www.ncbi.nlm.nih.gov/pubmed/12808457">1</a>], [<a href="http://www.ncbi.nlm.nih.gov/pubmed/16199517">2</a>].</p>

<p><a name="testing"></a></p>

<h2 id="hypothesis-testing-for-gene-sets">Hypothesis testing for gene sets</h2>

<p>The normal approximation stated above for <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msqrt&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msqrt&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-52" style="width: 2.979em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.443em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1002.38em 2.562em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-53"><span class="msqrt" id="MathJax-Span-54"><span style="display: inline-block; position: relative; width: 1.848em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0.836em;"><span class="mrow" id="MathJax-Span-55"><span class="mi" id="MathJax-Span-56" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.515em 1001.01em 3.932em -999.997em); top: -4.521em; left: 0.836em;"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: -0.057em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: 0.301em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1000.84em 4.348em -999.997em); top: -4.045em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="texatom" id="MathJax-Span-57"><span class="mrow" id="MathJax-Span-58"><span class="munderover" id="MathJax-Span-59"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-60" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-61" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msqrt><mi>N</mi></msqrt><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-5">\sqrt{N} \bar{t}</script> that the t-statistics are independent and identically distributed. For example, the second equality here:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mstyle displaystyle=&quot;false&quot; scriptlevel=&quot;0&quot;&gt;&lt;mtext&gt;var&lt;/mtext&gt;&lt;/mstyle&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo&gt;&amp;#x22EF;&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mstyle displaystyle=&quot;false&quot; scriptlevel=&quot;0&quot;&gt;&lt;mtext&gt;var&lt;/mtext&gt;&lt;/mstyle&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo&gt;&amp;#x22EF;&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mstyle displaystyle=&quot;false&quot; scriptlevel=&quot;0&quot;&gt;&lt;mtext&gt;var&lt;/mtext&gt;&lt;/mstyle&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-62" style="width: 36.432em; display: inline-block;"><span style="display: inline-block; position: relative; width: 30.36em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.658em 1030.36em 3.158em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-63"><span class="mi" id="MathJax-Span-64" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span class="mi" id="MathJax-Span-65" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-66" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-67" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-68"><span class="mrow" id="MathJax-Span-69"><span class="munderover" id="MathJax-Span-70"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-71" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-72" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-73" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-74" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span><span class="mfrac" id="MathJax-Span-75" style="padding-left: 0.301em;"><span style="display: inline-block; position: relative; width: 1.491em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mn" id="MathJax-Span-76" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1001.37em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.711em;"><span class="msubsup" id="MathJax-Span-77"><span style="display: inline-block; position: relative; width: 1.372em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-78" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.283em; left: 0.955em;"><span class="mn" id="MathJax-Span-79" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1001.49em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.491em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span><span class="mstyle" id="MathJax-Span-80"><span class="mrow" id="MathJax-Span-81"><span class="mtext" id="MathJax-Span-82" style="font-family: MathJax_Main;">var</span></span></span><span class="mo" id="MathJax-Span-83" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-84"><span style="display: inline-block; position: relative; width: 0.777em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.36em;"><span class="mn" id="MathJax-Span-86" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-87" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mo" id="MathJax-Span-88" style="font-family: MathJax_Main; padding-left: 0.241em;">⋯</span><span class="mo" id="MathJax-Span-89" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="msubsup" id="MathJax-Span-90" style="padding-left: 0.241em;"><span style="display: inline-block; position: relative; width: 1.074em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-91" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.36em;"><span class="mi" id="MathJax-Span-92" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-93" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-94" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span><span class="mfrac" id="MathJax-Span-95" style="padding-left: 0.301em;"><span style="display: inline-block; position: relative; width: 1.491em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mn" id="MathJax-Span-96" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1001.37em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.711em;"><span class="msubsup" id="MathJax-Span-97"><span style="display: inline-block; position: relative; width: 1.372em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.283em; left: 0.955em;"><span class="mn" id="MathJax-Span-99" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1001.49em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.491em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span><span class="mo" id="MathJax-Span-100" style="font-family: MathJax_Main;">(</span><span class="mstyle" id="MathJax-Span-101"><span class="mrow" id="MathJax-Span-102"><span class="mtext" id="MathJax-Span-103" style="font-family: MathJax_Main;">var</span></span></span><span class="mo" id="MathJax-Span-104" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-105"><span style="display: inline-block; position: relative; width: 0.777em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.36em;"><span class="mn" id="MathJax-Span-107" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-108" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-109" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mo" id="MathJax-Span-110" style="font-family: MathJax_Main; padding-left: 0.241em;">⋯</span><span class="mo" id="MathJax-Span-111" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mstyle" id="MathJax-Span-112" style="padding-left: 0.241em;"><span class="mrow" id="MathJax-Span-113"><span class="mtext" id="MathJax-Span-114" style="font-family: MathJax_Main;">var</span></span></span><span class="mo" id="MathJax-Span-115" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-116"><span style="display: inline-block; position: relative; width: 1.074em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-117" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.36em;"><span class="mi" id="MathJax-Span-118" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-119" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-120" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-121" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span><span class="mfrac" id="MathJax-Span-122" style="padding-left: 0.301em;"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mn" id="MathJax-Span-123" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.271em; left: 50%; margin-left: -0.414em;"><span class="mi" id="MathJax-Span-124" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1001.01em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.015em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.996em; border-left: 0px solid; width: 0px; height: 2.646em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><msup><mi>N</mi><mn>2</mn></msup></mfrac><mstyle displaystyle="false" scriptlevel="0"><mtext>var</mtext></mstyle><mo stretchy="false">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>t</mi><mi>N</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><msup><mi>N</mi><mn>2</mn></msup></mfrac><mo stretchy="false">(</mo><mstyle displaystyle="false" scriptlevel="0"><mtext>var</mtext></mstyle><mo stretchy="false">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mo>⋯</mo><mo>+</mo><mstyle displaystyle="false" scriptlevel="0"><mtext>var</mtext></mstyle><mo stretchy="false">(</mo><msub><mi>t</mi><mi>N</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-6">Var(\bar{t})= \frac{1}{N^2} \mbox{var}(t_1 + \dots + t_N) = \frac{1}{N^2}(\mbox{var}(t_1)+\dots+\mbox{var}(t_N)) = \frac{1}{N}</script>

<p>assumes independence. However, even under the null we may expect gene sets to correlate. To see this we can take the average of all pairwise correlations in each gene set and see that they are not always 0:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">gsids</span><span class="p">,</span><span class="n">length</span><span class="p">)</span><span class="w">
</span><span class="n">ind1</span><span class="o">&lt;-</span><span class="n">which</span><span class="p">(</span><span class="n">X</span><span class="o">==</span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">ind2</span><span class="o">&lt;-</span><span class="n">which</span><span class="p">(</span><span class="n">X</span><span class="o">==</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">corrs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">gsids</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">ind</span><span class="p">){</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">&gt;=</span><span class="m">2</span><span class="p">){</span><span class="w">
    </span><span class="n">cc1</span><span class="o">&lt;-</span><span class="n">cor</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">geneExpression</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="n">ind1</span><span class="p">]))</span><span class="w">
    </span><span class="n">cc2</span><span class="o">&lt;-</span><span class="n">cor</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">geneExpression</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="n">ind2</span><span class="p">]))</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">median</span><span class="p">(</span><span class="n">cc1</span><span class="p">[</span><span class="n">lower.tri</span><span class="p">(</span><span class="n">cc1</span><span class="p">)]),</span><span class="w">
    </span><span class="n">median</span><span class="p">(</span><span class="n">cc2</span><span class="p">[</span><span class="n">lower.tri</span><span class="p">(</span><span class="n">cc2</span><span class="p">)])))</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">))</span><span class="w">
</span><span class="p">}))</span><span class="w">
</span><span class="n">mypar</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">corrs</span><span class="p">[</span><span class="n">N</span><span class="o">&gt;</span><span class="m">10</span><span class="p">,],</span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Correlation within females"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Correlation within males"</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="./Gene set analysis_files/bioc1_geneset_1-unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14"></p>

<p>Note that in the case that the test statistics for the genes in a gene set have correlation <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-125" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em 1000.54em 2.622em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-126"><span class="mi" id="MathJax-Span-127" style="font-family: MathJax_Math-italic;">ρ</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ρ</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">\rho</script>, the variance of the average t-statistics will be:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right center left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0 thickmathspace&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mstyle displaystyle=&quot;false&quot; scriptlevel=&quot;0&quot;&gt;&lt;mtext&gt;var&lt;/mtext&gt;&lt;/mstyle&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-128" style="width: 31.015em; display: inline-block;"><span style="display: inline-block; position: relative; width: 25.836em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(-4.402em 1025.66em 8.336em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-129"><span class="mtable" id="MathJax-Span-130" style="padding-right: 0.182em; padding-left: 0.182em;"><span style="display: inline-block; position: relative; width: 25.479em; height: 0px;"><span style="position: absolute; clip: rect(6.074em 1003.04em 17.563em -999.997em); top: -12.14em; left: 0em;"><span style="display: inline-block; position: relative; width: 3.098em; height: 0px;"><span style="position: absolute; clip: rect(2.979em 1003.04em 4.408em -999.997em); top: -9.045em; right: 0em;"><span class="mtd" id="MathJax-Span-131"><span class="mrow" id="MathJax-Span-132"><span class="mi" id="MathJax-Span-133" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span class="mi" id="MathJax-Span-134" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-136" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-137"><span class="mrow" id="MathJax-Span-138"><span class="munderover" id="MathJax-Span-139"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-140" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-141" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-142" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.812em 1000em 4.17em -999.997em); top: -5.176em; right: 0em;"><span class="mtd" id="MathJax-Span-175"><span class="mrow" id="MathJax-Span-176"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.812em 1000em 4.17em -999.997em); top: -1.128em; right: 0em;"><span class="mtd" id="MathJax-Span-264"><span class="mrow" id="MathJax-Span-265"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.812em 1000em 4.17em -999.997em); top: 1.253em; right: 0em;"><span class="mtd" id="MathJax-Span-288"><span class="mrow" id="MathJax-Span-289"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 12.146em;"></span></span><span style="position: absolute; clip: rect(6.074em 1001.01em 17.146em -999.997em); top: -11.723em; left: 3.098em;"><span style="display: inline-block; position: relative; width: 1.074em; height: 0px;"><span style="position: absolute; clip: rect(3.455em 1001.01em 4.17em -999.997em); top: -9.045em; left: 50%; margin-left: -0.533em;"><span class="mtd" id="MathJax-Span-143"><span class="mrow" id="MathJax-Span-144"><span class="mi" id="MathJax-Span-145"></span><span class="mo" id="MathJax-Span-146" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.455em 1001.01em 4.17em -999.997em); top: -5.176em; left: 50%; margin-left: -0.533em;"><span class="mtd" id="MathJax-Span-177"><span class="mrow" id="MathJax-Span-178"><span class="mi" id="MathJax-Span-179"></span><span class="mo" id="MathJax-Span-180" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.455em 1001.01em 4.17em -999.997em); top: -1.128em; left: 50%; margin-left: -0.533em;"><span class="mtd" id="MathJax-Span-266"><span class="mrow" id="MathJax-Span-267"><span class="mi" id="MathJax-Span-268"></span><span class="mo" id="MathJax-Span-269" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.455em 1001.01em 4.17em -999.997em); top: 1.253em; left: 50%; margin-left: -0.533em;"><span class="mtd" id="MathJax-Span-290"><span class="mrow" id="MathJax-Span-291"><span class="mi" id="MathJax-Span-292"></span><span class="mo" id="MathJax-Span-293" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 11.729em;"></span></span><span style="position: absolute; clip: rect(6.729em 1021.01em 19.467em -999.997em); top: -13.33em; left: 4.467em;"><span style="display: inline-block; position: relative; width: 21.015em; height: 0px;"><span style="position: absolute; clip: rect(2.443em 1011.61em 4.943em -999.997em); top: -9.045em; left: 0em;"><span class="mtd" id="MathJax-Span-147"><span class="mrow" id="MathJax-Span-148"><span class="mfrac" id="MathJax-Span-149"><span style="display: inline-block; position: relative; width: 1.491em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mn" id="MathJax-Span-150" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1001.37em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.711em;"><span class="msubsup" id="MathJax-Span-151"><span style="display: inline-block; position: relative; width: 1.372em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-152" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.283em; left: 0.955em;"><span class="mn" id="MathJax-Span-153" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1001.49em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.491em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span><span class="mstyle" id="MathJax-Span-154"><span class="mrow" id="MathJax-Span-155"><span class="mtext" id="MathJax-Span-156" style="font-family: MathJax_Main;">var</span></span></span><span class="mo" id="MathJax-Span-157" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-158" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-159" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-160" style="font-family: MathJax_Main; padding-left: 0.182em;">…</span><span class="mn" id="MathJax-Span-161" style="font-family: MathJax_Main; padding-left: 0.182em;">1</span><span class="mo" id="MathJax-Span-162" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-163" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-164"><span style="display: inline-block; position: relative; width: 0.777em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-165" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.36em;"><span class="mn" id="MathJax-Span-166" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-167" style="font-family: MathJax_Main; padding-left: 0.182em;">…</span><span class="msubsup" id="MathJax-Span-168" style="padding-left: 0.182em;"><span style="display: inline-block; position: relative; width: 1.074em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-169" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.36em;"><span class="mi" id="MathJax-Span-170" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msup" id="MathJax-Span-171"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px;"><span style="position: absolute; clip: rect(3.039em 1000.3em 4.408em -999.997em); top: -3.985em; left: 0em;"><span class="mo" id="MathJax-Span-172" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.42em;"><span class="mo" id="MathJax-Span-173" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-174" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1021.01em 8.813em -999.997em); top: -7.438em; left: 0em;"><span class="mtd" id="MathJax-Span-181"><span class="mrow" id="MathJax-Span-182"><span class="mfrac" id="MathJax-Span-183"><span style="display: inline-block; position: relative; width: 1.491em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mn" id="MathJax-Span-184" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1001.37em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.711em;"><span class="msubsup" id="MathJax-Span-185"><span style="display: inline-block; position: relative; width: 1.372em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-186" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.283em; left: 0.955em;"><span class="mn" id="MathJax-Span-187" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1001.49em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.491em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span><span class="mo" id="MathJax-Span-188" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-189" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-190" style="font-family: MathJax_Main; padding-left: 0.182em;">…</span><span class="mn" id="MathJax-Span-191" style="font-family: MathJax_Main; padding-left: 0.182em;">1</span><span class="mo" id="MathJax-Span-192" style="font-family: MathJax_Main;">)</span><span class="mrow" id="MathJax-Span-193" style="padding-left: 0.182em;"><span class="mo" id="MathJax-Span-194" style="vertical-align: 2.86em;"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.854em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: 0.598em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.604em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.068em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -0.473em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mtable" id="MathJax-Span-195" style="padding-right: 0.182em; padding-left: 0.182em;"><span style="display: inline-block; position: relative; width: 9.884em; height: 0px;"><span style="position: absolute; clip: rect(3.217em 1001.07em 8.693em -999.997em); top: -6.128em; left: 0em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -6.068em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-196"><span class="mrow" id="MathJax-Span-197"><span class="mn" id="MathJax-Span-198" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-211"><span class="mrow" id="MathJax-Span-212"><span class="mi" id="MathJax-Span-213" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.693em 1001.07em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.592em;"><span class="mtd" id="MathJax-Span-226"><span class="mrow" id="MathJax-Span-227"><span class="mo" id="MathJax-Span-228" style="font-family: MathJax_Main;">…</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -1.842em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-241"><span class="mrow" id="MathJax-Span-242"><span class="mi" id="MathJax-Span-243" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.134em;"></span></span><span style="position: absolute; clip: rect(3.217em 1001.07em 8.455em -999.997em); top: -5.89em; left: 2.146em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -6.068em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-199"><span class="mrow" id="MathJax-Span-200"><span class="mi" id="MathJax-Span-201" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-214"><span class="mrow" id="MathJax-Span-215"><span class="mn" id="MathJax-Span-216" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.693em 1001.07em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.592em;"><span class="mtd" id="MathJax-Span-229"><span class="mrow" id="MathJax-Span-230"><span class="mo" id="MathJax-Span-231" style="font-family: MathJax_Main;">…</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -1.842em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-244"><span class="mrow" id="MathJax-Span-245"><span class="mi" id="MathJax-Span-246" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.896em;"></span></span><span style="position: absolute; clip: rect(2.979em 1001.07em 7.682em -999.997em); top: -5.354em; left: 4.348em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.693em 1001.07em 4.17em -999.997em); top: -6.068em; left: 50%; margin-left: -0.592em;"><span class="mtd" id="MathJax-Span-202"><span class="mrow" id="MathJax-Span-203"><span class="mo" id="MathJax-Span-204" style="font-family: MathJax_Main;">…</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-217"><span class="mrow" id="MathJax-Span-218"><span class="mi" id="MathJax-Span-219" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.693em 1001.07em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.592em;"><span class="mtd" id="MathJax-Span-232"><span class="mrow" id="MathJax-Span-233"><span class="mo" id="MathJax-Span-234" style="font-family: MathJax_Main;">…</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.693em 1001.07em 4.17em -999.997em); top: -1.842em; left: 50%; margin-left: -0.592em;"><span class="mtd" id="MathJax-Span-247"><span class="mrow" id="MathJax-Span-248"><span class="mo" id="MathJax-Span-249" style="font-family: MathJax_Main;">…</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.36em;"></span></span><span style="position: absolute; clip: rect(3.217em 1001.07em 8.455em -999.997em); top: -5.89em; left: 6.491em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -6.068em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-205"><span class="mrow" id="MathJax-Span-206"><span class="mi" id="MathJax-Span-207" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.693em 1001.07em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.592em;"><span class="mtd" id="MathJax-Span-220"><span class="mrow" id="MathJax-Span-221"><span class="mo" id="MathJax-Span-222" style="font-family: MathJax_Main;">…</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.693em 1001.07em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.592em;"><span class="mtd" id="MathJax-Span-235"><span class="mrow" id="MathJax-Span-236"><span class="mo" id="MathJax-Span-237" style="font-family: MathJax_Main;">…</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -1.842em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-250"><span class="mrow" id="MathJax-Span-251"><span class="mi" id="MathJax-Span-252" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.896em;"></span></span><span style="position: absolute; clip: rect(2.979em 1001.07em 7.979em -999.997em); top: -5.652em; left: 8.693em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -6.068em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-208"><span class="mrow" id="MathJax-Span-209"><span class="mi" id="MathJax-Span-210" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.396em 1000.54em 4.408em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-223"><span class="mrow" id="MathJax-Span-224"><span class="mi" id="MathJax-Span-225" style="font-family: MathJax_Math-italic;">ρ</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.693em 1001.07em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.592em;"><span class="mtd" id="MathJax-Span-238"><span class="mrow" id="MathJax-Span-239"><span class="mo" id="MathJax-Span-240" style="font-family: MathJax_Main;">…</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -1.842em; left: 50%; margin-left: -0.235em;"><span class="mtd" id="MathJax-Span-253"><span class="mrow" id="MathJax-Span-254"><span class="mn" id="MathJax-Span-255" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.658em;"></span></span></span></span><span class="mo" id="MathJax-Span-256" style="vertical-align: 2.86em;"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.854em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: 0.598em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.604em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.068em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -0.473em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-257" style="font-family: MathJax_Main; padding-left: 0.182em;">(</span><span class="mn" id="MathJax-Span-258" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-259" style="font-family: MathJax_Main; padding-left: 0.182em;">…</span><span class="mn" id="MathJax-Span-260" style="font-family: MathJax_Main; padding-left: 0.182em;">1</span><span class="msup" id="MathJax-Span-261"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px;"><span style="position: absolute; clip: rect(3.039em 1000.3em 4.408em -999.997em); top: -3.985em; left: 0em;"><span class="mo" id="MathJax-Span-262" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.42em;"><span class="mo" id="MathJax-Span-263" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 6.253em;"></span></span><span style="position: absolute; clip: rect(2.443em 1009.65em 4.943em -999.997em); top: -1.128em; left: 0em;"><span class="mtd" id="MathJax-Span-270"><span class="mrow" id="MathJax-Span-271"><span class="mfrac" id="MathJax-Span-272"><span style="display: inline-block; position: relative; width: 1.491em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mn" id="MathJax-Span-273" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1001.37em 4.17em -999.997em); top: -3.211em; left: 50%; margin-left: -0.711em;"><span class="msubsup" id="MathJax-Span-274"><span style="display: inline-block; position: relative; width: 1.372em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-275" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.283em; left: 0.955em;"><span class="mn" id="MathJax-Span-276" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1001.49em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.491em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span><span class="mo" id="MathJax-Span-277" style="font-family: MathJax_Main;">{</span><span class="mi" id="MathJax-Span-278" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-279" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mo" id="MathJax-Span-280" style="font-family: MathJax_Main; padding-left: 0.241em;">(</span><span class="mi" id="MathJax-Span-281" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-282" style="font-family: MathJax_Main; padding-left: 0.241em;">−</span><span class="mn" id="MathJax-Span-283" style="font-family: MathJax_Main; padding-left: 0.241em;">1</span><span class="mo" id="MathJax-Span-284" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-285" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mi" id="MathJax-Span-286" style="font-family: MathJax_Math-italic;">ρ</span><span class="mo" id="MathJax-Span-287" style="font-family: MathJax_Main;">}</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(2.443em 1007.86em 4.884em -999.997em); top: 1.253em; left: 0em;"><span class="mtd" id="MathJax-Span-294"><span class="mrow" id="MathJax-Span-295"><span class="mfrac" id="MathJax-Span-296"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(3.158em 1000.42em 4.17em -999.997em); top: -4.64em; left: 50%; margin-left: -0.235em;"><span class="mn" id="MathJax-Span-297" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.271em; left: 50%; margin-left: -0.414em;"><span class="mi" id="MathJax-Span-298" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1001.01em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.015em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span><span class="mo" id="MathJax-Span-299" style="font-family: MathJax_Main;">{</span><span class="mn" id="MathJax-Span-300" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-301" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mo" id="MathJax-Span-302" style="font-family: MathJax_Main; padding-left: 0.241em;">(</span><span class="mi" id="MathJax-Span-303" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-304" style="font-family: MathJax_Main; padding-left: 0.241em;">−</span><span class="mn" id="MathJax-Span-305" style="font-family: MathJax_Main; padding-left: 0.241em;">1</span><span class="mo" id="MathJax-Span-306" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-307" style="font-family: MathJax_Math-italic;">ρ</span><span class="mo" id="MathJax-Span-308" style="font-family: MathJax_Main;">}</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 13.336em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -7.211em; border-left: 0px solid; width: 0px; height: 15.004em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right center left" rowspacing="3pt" columnspacing="0 thickmathspace" displaystyle="true"><mtr><mtd><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow><mo stretchy="false">)</mo></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mfrac><mn>1</mn><msup><mi>N</mi><mn>2</mn></msup></mfrac><mstyle displaystyle="false" scriptlevel="0"><mtext>var</mtext></mstyle><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mn>1</mn><mo>…</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo>…</mo><msub><mi>t</mi><mi>N</mi></msub><msup><mo stretchy="false">)</mo><mo>′</mo></msup><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mfrac><mn>1</mn><msup><mi>N</mi><mn>2</mn></msup></mfrac><mo stretchy="false">(</mo><mn>1</mn><mo>…</mo><mn>1</mn><mo stretchy="false">)</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mn>1</mn></mtd><mtd><mi>ρ</mi></mtd><mtd><mo>…</mo></mtd><mtd><mi>ρ</mi></mtd><mtd><mi>ρ</mi></mtd></mtr><mtr><mtd><mi>ρ</mi></mtd><mtd><mn>1</mn></mtd><mtd><mi>ρ</mi></mtd><mtd><mo>…</mo></mtd><mtd><mi>ρ</mi></mtd></mtr><mtr><mtd><mo>…</mo></mtd><mtd><mo>…</mo></mtd><mtd><mo>…</mo></mtd><mtd><mo>…</mo></mtd><mtd><mo>…</mo></mtd></mtr><mtr><mtd><mi>ρ</mi></mtd><mtd><mi>ρ</mi></mtd><mtd><mo>…</mo></mtd><mtd><mi>ρ</mi></mtd><mtd><mn>1</mn></mtd></mtr></mtable><mo>)</mo></mrow><mo stretchy="false">(</mo><mn>1</mn><mo>…</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mo>′</mo></msup></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mfrac><mn>1</mn><msup><mi>N</mi><mn>2</mn></msup></mfrac><mo fence="false" stretchy="false">{</mo><mi>N</mi><mo>+</mo><mo stretchy="false">(</mo><mi>N</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>N</mi><mi>ρ</mi><mo fence="false" stretchy="false">}</mo></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mfrac><mn>1</mn><mi>N</mi></mfrac><mo fence="false" stretchy="false">{</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mi>N</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>ρ</mi><mo fence="false" stretchy="false">}</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-8">% <![CDATA[
\begin{eqnarray}
Var(\bar{t}) &=& \frac{1}{N^2} \mbox{var}( (1 \dots 1) (t_1 \dots
t_N)' ) \\
&=& \frac{1}{N^2}(1 \dots 1)
\begin{pmatrix}
1 & \rho & \dots & \rho & \rho \\
\rho & 1 & \rho & \dots  & \rho \\
\dots & \dots & \dots & \dots & \dots \\
\rho &  \rho & \dots & \rho & 1 \\
\end{pmatrix}
(1 \dots 1) ' \\
&=& \frac{1}{N^2}\{N + (N-1) N \rho \} \\
&=& \frac{1}{N}\{1 + (N-1) \rho \} \\
\end{eqnarray} %]]></script>

<p>Note that when <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-309" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em 1000.54em 2.622em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-310"><span class="mi" id="MathJax-Span-311" style="font-family: MathJax_Math-italic;">ρ</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ρ</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">\rho</script> is positive, the variance is inflated by <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-312" style="width: 8.039em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.67em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.253em 1006.61em 2.622em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-313"><span class="mo" id="MathJax-Span-314" style="font-family: MathJax_Main;">{</span><span class="mn" id="MathJax-Span-315" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-316" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mo" id="MathJax-Span-317" style="font-family: MathJax_Main; padding-left: 0.241em;">(</span><span class="mi" id="MathJax-Span-318" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-319" style="font-family: MathJax_Main; padding-left: 0.241em;">−</span><span class="mn" id="MathJax-Span-320" style="font-family: MathJax_Main; padding-left: 0.241em;">1</span><span class="mo" id="MathJax-Span-321" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-322" style="font-family: MathJax_Math-italic;">ρ</span><span class="mo" id="MathJax-Span-323" style="font-family: MathJax_Main;">}</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">{</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mi>N</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>ρ</mi><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-10">\{1 + (N-1) \rho \}</script>. Although in general we don’t expect all the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-324" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em 1000.54em 2.622em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-325"><span class="mi" id="MathJax-Span-326" style="font-family: MathJax_Math-italic;">ρ</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ρ</mi></math></span></span><script type="math/tex" id="MathJax-Element-11">\rho</script> to be the same within a gene set, a correction factor can still be computed for each gene set that depends on the average <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-327" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em 1000.54em 2.622em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-328"><span class="mi" id="MathJax-Span-329" style="font-family: MathJax_Math-italic;">ρ</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ρ</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">\rho</script> in the gene set. The formula can been seen on page 295 [here] (http://dx.doi.org/10.1214/07-AOAS146). The formula for the correction for the Wald statistic is also included.</p>

<p>These correction factor can be used to adapt the simple summary statistics described above. In fact, several methods have been published that are based on the simple mean shift approach but take correlation into account to develop summary statistics and statistical inference based on asymptotic approximations <a href="http://www.ncbi.nlm.nih.gov/pubmed/?term=20610611">ROAST</a>, <a href="http://www.ncbi.nlm.nih.gov/pubmed/22638577">CAMERA</a>. In the computer labs we will demonstrate one of these pieces of software. For simplicity, here we
create approximation based on <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msqrt&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msqrt&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-330" style="width: 2.979em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.443em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1002.38em 2.562em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-331"><span class="msqrt" id="MathJax-Span-332"><span style="display: inline-block; position: relative; width: 1.848em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0.836em;"><span class="mrow" id="MathJax-Span-333"><span class="mi" id="MathJax-Span-334" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.515em 1001.01em 3.932em -999.997em); top: -4.521em; left: 0.836em;"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: -0.057em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: 0.301em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1000.84em 4.348em -999.997em); top: -4.045em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="texatom" id="MathJax-Span-335"><span class="mrow" id="MathJax-Span-336"><span class="munderover" id="MathJax-Span-337"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-338" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-339" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msqrt><mi>N</mi></msqrt><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-13">\sqrt{N} \bar{t}</script> and use the correction factor. Here compare the original <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msqrt&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msqrt&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-340" style="width: 2.979em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.443em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1002.38em 2.562em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-341"><span class="msqrt" id="MathJax-Span-342"><span style="display: inline-block; position: relative; width: 1.848em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0.836em;"><span class="mrow" id="MathJax-Span-343"><span class="mi" id="MathJax-Span-344" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.515em 1001.01em 3.932em -999.997em); top: -4.521em; left: 0.836em;"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: -0.057em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: 0.301em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1000.84em 4.348em -999.997em); top: -4.045em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="texatom" id="MathJax-Span-345"><span class="mrow" id="MathJax-Span-346"><span class="munderover" id="MathJax-Span-347"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-348" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-349" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msqrt><mi>N</mi></msqrt><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-14">\sqrt{N} \bar{t}</script> to the corrected version:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;msqrt&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msqrt&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/msqrt&gt;&lt;/mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-350" style="width: 9.289em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.741em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.479em 1007.68em 3.574em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-351"><span class="mfrac" id="MathJax-Span-352"><span style="display: inline-block; position: relative; width: 6.908em; height: 0px; margin-right: 0.122em; margin-left: 0.122em;"><span style="position: absolute; clip: rect(2.979em 1001.85em 4.348em -999.997em); top: -4.64em; left: 50%; margin-left: -0.89em;"><span class="msqrt" id="MathJax-Span-353"><span style="display: inline-block; position: relative; width: 1.848em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.9em 4.17em -999.997em); top: -3.985em; left: 0.836em;"><span class="mrow" id="MathJax-Span-354"><span class="mi" id="MathJax-Span-355" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.515em 1001.01em 3.932em -999.997em); top: -4.521em; left: 0.836em;"><span style="display: inline-block; position: relative; width: 1.015em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: -0.057em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: 0.301em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.039em 1000.84em 4.348em -999.997em); top: -4.045em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(2.979em 1006.79em 4.527em -999.997em); top: -3.152em; left: 50%; margin-left: -3.39em;"><span class="msqrt" id="MathJax-Span-356"><span style="display: inline-block; position: relative; width: 6.789em; height: 0px;"><span style="position: absolute; clip: rect(3.039em 1005.66em 4.408em -999.997em); top: -3.985em; left: 1.015em;"><span class="mrow" id="MathJax-Span-357"><span class="mn" id="MathJax-Span-358" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-359" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mo" id="MathJax-Span-360" style="font-family: MathJax_Main; padding-left: 0.241em;">(</span><span class="mi" id="MathJax-Span-361" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-362" style="font-family: MathJax_Main; padding-left: 0.241em;">−</span><span class="mn" id="MathJax-Span-363" style="font-family: MathJax_Main; padding-left: 0.241em;">1</span><span class="mo" id="MathJax-Span-364" style="font-family: MathJax_Main;">)</span><span class="texatom" id="MathJax-Span-365"><span class="mrow" id="MathJax-Span-366"><span class="munderover" id="MathJax-Span-367"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px;"><span style="position: absolute; clip: rect(3.396em 1000.42em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-368" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.045em; left: 0.063em;"><span class="mo" id="MathJax-Span-369" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.515em 1005.78em 3.932em -999.997em); top: -4.521em; left: 1.015em;"><span style="display: inline-block; position: relative; width: 5.777em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: -0.057em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.985em; left: 5.063em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 0.42em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 0.955em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 1.432em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 1.967em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 2.503em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 2.979em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 3.515em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 4.051em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.985em; left: 4.586em;">−<span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(2.979em 1001.01em 4.527em -999.997em); top: -3.985em; left: 0em;"><span style="font-family: MathJax_Size1;">√</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(0.836em 1006.91em 1.253em -999.997em); top: -1.307em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.908em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span><span class="texatom" id="MathJax-Span-370"><span class="mrow" id="MathJax-Span-371"><span class="munderover" id="MathJax-Span-372"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.36em 4.17em -999.997em); top: -3.985em; left: 0.063em;"><span class="mi" id="MathJax-Span-373" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.217em 1000.42em 3.634em -999.997em); top: -4.223em; left: 0.063em;"><span class="mo" id="MathJax-Span-374" style="font-family: MathJax_Main;">¯</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.496em; border-left: 0px solid; width: 0px; height: 3.432em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><msqrt><mi>N</mi></msqrt><msqrt><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mi>N</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>r</mi><mo stretchy="false">¯</mo></mover></mrow></msqrt></mfrac><mrow class="MJX-TeXAtom-ORD"><mover><mi>t</mi><mo stretchy="false">¯</mo></mover></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-15">\frac{\sqrt{N}}{\sqrt{1+(N-1)\bar{r}}}\bar{t}</script>

<p>In the plot below we notice that this correction attenuates (brings values closer to 0) the scores. Note in particular, the third highest value is now quite close to 0 and is no longer significant (see arrow).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">avgcorrs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rowMeans</span><span class="p">(</span><span class="n">corrs</span><span class="p">)</span><span class="w">
</span><span class="n">cf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="p">(</span><span class="n">N</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="n">avgcorrs</span><span class="p">)</span><span class="w">
</span><span class="n">cf</span><span class="p">[</span><span class="n">cf</span><span class="o">&lt;</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1">## we ignore negative correlations
</span><span class="n">correctedavgt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">avgt</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span><span class="w">
</span><span class="n">parampvaliid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="o">*</span><span class="n">pnorm</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">avgt</span><span class="p">))</span><span class="w">
</span><span class="n">parampval</span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="o">*</span><span class="n">pnorm</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">correctedavgt</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">avgt</span><span class="p">,</span><span class="n">correctedavgt</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="n">pch</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Original"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"With correction factor"</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-7</span><span class="p">,</span><span class="m">20</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-7</span><span class="p">,</span><span class="m">20</span><span class="p">),</span><span class="n">cex</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">thirdhighest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="n">avgt</span><span class="p">)[</span><span class="m">3</span><span class="p">]</span><span class="w">
</span><span class="n">arrows</span><span class="p">(</span><span class="n">avgt</span><span class="p">[</span><span class="n">thirdhighest</span><span class="p">]</span><span class="m">+3</span><span class="p">,</span><span class="n">correctedavgt</span><span class="p">[</span><span class="n">thirdhighest</span><span class="p">],</span><span class="n">x</span><span class="m">1</span><span class="o">=</span><span class="n">avgt</span><span class="p">[</span><span class="n">thirdhighest</span><span class="p">]</span><span class="m">+0.5</span><span class="p">,</span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="./Gene set analysis_files/bioc1_geneset_1-unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15"></p>

<p>Note that the highlighted gene set has relatively high correlation and size, which makes the correction factor large.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">avgcorrs</span><span class="p">[</span><span class="n">thirdhighest</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##   chrxp22 
## 0.0287052
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">gsids</span><span class="p">[[</span><span class="n">thirdhighest</span><span class="p">]])</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 76
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">cf</span><span class="p">[</span><span class="n">thirdhighest</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## chrxp22 
## 3.15289
</code></pre>
</div>

<p>In this unit we have used the average t-statistic as a simple example of a summary statistic for gene sets for which we can estimate a null-hypothesis. We demonstrated how that a correction factor is needed when the genes in the gene set are not independent. Note that we used the average t-statistic as a simple illustration and that for a more rigorous treatment implementing the testing-for-mean-shifts approach you can see <a href="http://www.ncbi.nlm.nih.gov/pubmed/15647293">SAFE</a>, <a href="http://www.ncbi.nlm.nih.gov/pubmed/?term=20610611">ROAST</a>, <a href="http://www.ncbi.nlm.nih.gov/pubmed/22638577">CAMERA</a>.</p>

<p>Even after adjusting the average t-statistic with the inflation factor, the null distribution may not hold. For example, the original sample size and gene set size may be too small for the assumption that the average t-statistics are normal. In the next unit we demonstrate how we can use permutations to estimate the null distribution without parametric assumptions.</p>

<p><a name="permutations"></a></p>

<h2 id="permutations">Permutations</h2>
<p>When outcome of interest permits it and enough samples and are available an alternative to parametric tests is to perform gene set specific permutation test. This approach is implemented in several methods [<a href="http://www.ncbi.nlm.nih.gov/pubmed/16199517">1</a>], [<a href="http://www.ncbi.nlm.nih.gov/pubmed/16174746">2</a>]. For most enrichment scores one can create null distributions using permutations. For example, here we perform a permutation test for the simple average t-statistic summary:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">matrixStats</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## matrixStats v0.50.1 (2015-12-14) successfully loaded. See ?matrixStats for help.
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 
## Attaching package: 'matrixStats'
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## The following object is masked from 'package:GenomicFiles':
## 
##     rowRanges
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## The following object is masked from 'package:SummarizedExperiment':
## 
##     rowRanges
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## The following objects are masked from 'package:genefilter':
## 
##     rowSds, rowVars
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## The following objects are masked from 'package:Biobase':
## 
##     anyMissing, rowMedians
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">B</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="c1">##takes a few minutes
</span><span class="n">null</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">B</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">b</span><span class="p">){</span><span class="w">
 </span><span class="n">nullX</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w">
 </span><span class="n">nullsvaX</span><span class="o">&lt;-</span><span class="n">model.matrix</span><span class="p">(</span><span class="o">~</span><span class="n">nullX</span><span class="o">+</span><span class="n">svafit</span><span class="o">$</span><span class="n">sv</span><span class="p">)</span><span class="w"> </span><span class="c1">##note that we are not recomupting the surrogate values. 
</span><span class="w"> </span><span class="n">nulllmfit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmFit</span><span class="p">(</span><span class="n">geneExpression</span><span class="p">,</span><span class="n">nullsvaX</span><span class="p">)</span><span class="w">
 </span><span class="n">nulltt</span><span class="o">&lt;-</span><span class="n">nulllmfit</span><span class="o">$</span><span class="n">coef</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">nulllmfit</span><span class="o">$</span><span class="n">df.residual</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">nulllmfit</span><span class="o">$</span><span class="n">sigma</span><span class="p">)</span><span class="w">
 </span><span class="n">nullavgt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">gsids</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">mean</span><span class="p">(</span><span class="n">nulltt</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="w">
 </span><span class="nf">return</span><span class="p">(</span><span class="n">nullavgt</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="n">permavgt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">avgt</span><span class="o">/</span><span class="n">rowSds</span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w">
</span><span class="n">permpval</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rowMeans</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">avgt</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">null</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>In this case the results using permutations are very similar to the results using the parametric approach that uses the correction factor as can be seen in this comparison.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">correctedavgt</span><span class="p">,</span><span class="n">permavgt</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="n">pch</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Parametric z-score (with correction)"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Permutation z-score"</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">15</span><span class="p">),</span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">15</span><span class="p">))</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="./Gene set analysis_files/bioc1_geneset_1-unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18"></p>

<p>We can see that the q-values are also comparable</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">tab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">avgt</span><span class="o">=</span><span class="n">p.adjust</span><span class="p">(</span><span class="nf">signif</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">pnorm</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">avgt</span><span class="p">)),</span><span class="m">2</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s2">"BH"</span><span class="p">),</span><span class="w">
                  </span><span class="n">correctedavgt</span><span class="o">=</span><span class="n">p.adjust</span><span class="p">(</span><span class="nf">signif</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">pnorm</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">correctedavgt</span><span class="p">)),</span><span class="m">2</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s2">"BH"</span><span class="p">),</span><span class="w">
                  </span><span class="n">permutations</span><span class="o">=</span><span class="n">p.adjust</span><span class="p">(</span><span class="n">permpval</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"BH"</span><span class="p">))</span><span class="w">
</span><span class="c1">##include only gene sets with 10 or more genes in comparison
</span><span class="n">tab</span><span class="o">&lt;-</span><span class="n">tab</span><span class="p">[</span><span class="n">N</span><span class="o">&gt;=</span><span class="m">10</span><span class="p">,]</span><span class="w">
</span><span class="n">tab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="nf">signif</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="n">apply</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">rank</span><span class="p">))</span><span class="w">
</span><span class="n">tab</span><span class="o">&lt;-</span><span class="n">tab</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">tab</span><span class="p">[,</span><span class="m">1</span><span class="p">]),]</span><span class="w">
</span><span class="n">tab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tab</span><span class="p">[</span><span class="n">tab</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.25</span><span class="p">,]</span><span class="w">
</span><span class="n">tab</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##             avgt correctedavgt permutations avgt correctedavgt
## chryp11  1.9e-60       1.5e-37         0.00  1.0             1
## chryq11  4.2e-44       6.3e-02         0.00  2.0             3
## chrxq13  2.4e-06       5.3e-03         0.00  3.0             2
## chr17p13 2.5e-02       1.0e+00         0.00  4.5           124
## chr6p22  2.5e-02       1.0e+00         0.77  4.5           124
## chrxp11  3.4e-02       1.0e+00         0.70  6.0           124
## chr20p13 5.6e-02       9.7e-02         0.00  7.0             4
## chr4q35  9.7e-02       1.0e+00         0.39  8.0           124
##          permutations
## chryp11             4
## chryq11             4
## chrxq13             4
## chr17p13            4
## chr6p22           114
## chrxp11            78
## chr20p13            4
## chr4q35            18
</code></pre>
</div>

<p>One limitation of the permutation test approach is that to estimate very small p-values we need many permutations. For example, to distinguish between a p-value of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-375" style="width: 2.384em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.967em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.134em 1001.97em 2.384em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-376"><span class="msubsup" id="MathJax-Span-377"><span style="display: inline-block; position: relative; width: 1.967em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.96em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mn" id="MathJax-Span-378" style="font-family: MathJax_Main;">10</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 1.015em;"><span class="texatom" id="MathJax-Span-379"><span class="mrow" id="MathJax-Span-380"><span class="mo" id="MathJax-Span-381" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-382" style="font-size: 70.7%; font-family: MathJax_Main;">5</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>10</mn><mrow class="MJX-TeXAtom-ORD"><mo>−</mo><mn>5</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-16">10^{-5}</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;6&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-383" style="width: 2.384em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.967em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.134em 1001.97em 2.384em -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-384"><span class="msubsup" id="MathJax-Span-385"><span style="display: inline-block; position: relative; width: 1.967em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.96em 4.17em -999.997em); top: -3.985em; left: 0em;"><span class="mn" id="MathJax-Span-386" style="font-family: MathJax_Main;">10</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 1.015em;"><span class="texatom" id="MathJax-Span-387"><span class="mrow" id="MathJax-Span-388"><span class="mo" id="MathJax-Span-389" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-390" style="font-size: 70.7%; font-family: MathJax_Main;">6</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>10</mn><mrow class="MJX-TeXAtom-ORD"><mo>−</mo><mn>6</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-17">10^{-6}</script> we would need to run 1,000,000 permutations. For those interested in applying conservative multiple comparison correction (such as the Bonferonni correction), it would be necessary to run many simulations.</p>

<p>Another limitation is that in more complicated designs, for example an experiment with many factor and continuous covariates, deciphering how to permute is not straight forward.</p>

<h2 id="footnotes-a-namefoota">Footnotes <a name="foot"></a></h2>

<p>Virtaneva K, “Expression profiling reveals fundamental biological differences in acute myeloid leukemia with isolated trisomy 8 and normal cytogenetics.” PNAS 2001
<a href="http://www.ncbi.nlm.nih.gov/pubmed/?term=11158605">http://www.ncbi.nlm.nih.gov/pubmed/?term=11158605</a></p>

<p>Jelle J. Goeman and Peter Bühlmann, “Analyzing gene expression data in terms of gene sets: methodological issues” Bioinformatics 2006.
<a href="http://bioinformatics.oxfordjournals.org/content/23/8/980">http://bioinformatics.oxfordjournals.org/content/23/8/980</a></p>


  </div>
</div>


      </div>
      <hr>
      <footer>
        <p><small>
  <!-- start of Karl's footer; modify this part -->

<a href="http://genomicsclass.github.io/book/">PH525x</a>, 
Rafael Irizarry and Michael Love, 
<a href="https://github.com/genomicsclass/labs/blob/master/LICENSE">MIT License</a>

  <!-- end of Karl's footer; modify this part -->
        </small></p>
      </footer>

    </div>

    
  


<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Size1, sans-serif;"></div></div></body></html>